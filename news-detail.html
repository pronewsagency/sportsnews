<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>تفاصيل الخبر</title>
  <style>
    body { font-family: "Tajawal", sans-serif; background: #f4f4f4; padding: 20px; }
    .news-container { max-width: 800px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .news-container h1 { font-size: 24px; color: #333; text-align: right; }
    .news-container p { line-height: 1.8; color: #555; text-align: justify; }
    .news-container img { max-width: 100%; height: auto; display: block; margin: 15px auto; border-radius: 5px; }
    .main-image { width: 100%; height: auto; margin-bottom: 20px; border-radius: 8px; }
    .loading-msg { text-align: center; color: #777; padding: 20px; }
  </style>
</head>
<body>
  <div class="news-container" id="news-details">
    <div class="loading-msg">⏳ جاري تحميل تفاصيل الخبر...</div>
  </div>

  <script>
    const baseUrl = "https://www.footballgallery.net";
    const proxy = "https://api.allorigins.win/get?url=";
    const detailsContainer = document.getElementById("news-details");

    const params = new URLSearchParams(window.location.search);
    const articleUrl = params.get('link');

    if (articleUrl) {
      const decodedUrl = decodeURIComponent(articleUrl);

      fetch(proxy + encodeURIComponent(decodedUrl))
        .then(response => {
          if (!response.ok) {
            throw new Error('فشل جلب البيانات من البروكسي');
          }
          return response.json();
        })
        .then(data => {
          let parser = new DOMParser();
          let doc = parser.parseFromString(data.contents, "text/html");

          // **الكود الجديد والمهم هنا**
          const ogImageMeta = doc.querySelector("meta[property='og:image']");
          let mainImageHtml = '';
          if (ogImageMeta) {
              const src = ogImageMeta.getAttribute('content');
              mainImageHtml = `<img src="${src}" alt="صورة الخبر الرئيسية" class="main-image">`;
          }

          const titleElement = doc.querySelector(".news-details-title h1");
          let contentElement = doc.querySelector(".article-details-contents");
          if (!contentElement) {
              contentElement = doc.querySelector(".news-text-box");
          }

          if (titleElement && contentElement) {
            const title = titleElement.textContent.trim();
            let contentHtml = contentElement.innerHTML;
            
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = contentHtml;
            const images = tempDiv.querySelectorAll('img');
            
            images.forEach(img => {
              let src = img.getAttribute('src');
              let dataSrc = img.getAttribute('data-src');
              let dataOriginal = img.getAttribute('data-original');
              let srcset = img.getAttribute('srcset');

              if (dataSrc && dataSrc.startsWith('/')) {
                img.setAttribute('src', baseUrl + dataSrc);
                img.removeAttribute('data-src');
              } else if (dataOriginal && dataOriginal.startsWith('/')) {
                img.setAttribute('src', baseUrl + dataOriginal);
                img.removeAttribute('data-original');
              } else if (src && src.startsWith('/') && !src.includes('data:')) {
                img.setAttribute('src', baseUrl + src);
              }
              
              if (srcset) {
                const updatedSrcset = srcset.split(',').map(part => {
                  const url = part.trim().split(' ')[0];
                  if (url.startsWith('/')) {
                    return baseUrl + url + part.substring(url.length);
                  }
                  return part;
                }).join(', ');
                img.setAttribute('srcset', updatedSrcset);
              }
              img.classList.remove('lazyload', 'lazy'); 
            });
            contentHtml = tempDiv.innerHTML;
            
            detailsContainer.innerHTML = `${mainImageHtml}<h1>${title}</h1>${contentHtml}`;
          } else {
            detailsContainer.innerHTML = `<div class="loading-msg">⚠️ لم يتم العثور على عنوان أو تفاصيل الخبر.</div>`;
          }
        })
        .catch(err => {
          detailsContainer.innerHTML = `<div class="loading-msg">❌ خطأ في جلب البيانات: ${err.message}</div>`;
          console.error("Fetch error:", err);
        });
    } else {
      detailsContainer.innerHTML = `<div class="loading-msg">⚠️ لا يوجد رابط خبر محدد لعرضه.</div>`;
    }
  </script>
</body>
</html>
