<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تفاصيل الخبر</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: #1A237E; /* خلفية زرقاء غامقة */
      color: #fff; /* لون النص الافتراضي أبيض */
      padding-bottom: 60px; /* مساحة للقائمة السفلية */
    }
    .news-container {
      max-width: 800px;
      margin: 20px auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: none; /* مخفي في البداية */
    }
    .news-container h1, .news-container p {
      color: #000; /* لون النص الأسود داخل الحاوية البيضاء */
    }
    .news-container h1 {
      font-size: 24px;
      text-align: right;
      color: #333; /* عنوان الخبر يبقى بلون داكن */
    }
    .news-container p {
      line-height: 1.8;
      text-align: justify;
      color: #555; /* نص الخبر يبقى بلون داكن */
    }
    .news-container img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: 15px auto;
      border-radius: 5px; /* زوايا مقوسة للصور الداخلية */
    }
    .main-image {
      width: 100%;
      height: auto;
      margin-bottom: 20px;
      border-radius: 15px; /* زوايا مقوسة أكثر للصورة الرئيسية */
    }
    /* تنسيق السبينر */
    .loading-spinner-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 80vh; /* يوسّط السبينر في منتصف الشاشة */
    }
    .spinner-border {
      width: 3rem;
      height: 3rem;
      color: #fff !important; /* لون السبينر أبيض */
      border-right-color: transparent !important;
      border-top-color: transparent !important;
      animation: spinner-spin 0.75s linear infinite;
    }
    @keyframes spinner-spin {
      to { transform: rotate(360deg); }
    }
    /* تنسيق الشريط السفلي */
    .footer {
        position: fixed;
        bottom: 0;
        width: 100%;
        background: linear-gradient(to right, #A993F5, #64B5F6);
        box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding: 8px 0;
        z-index: 1000;
    }
    .footer-btn {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        color: #fff;
        text-decoration: none;
        font-size: 0.8rem;
        transition: transform 0.2s ease;
    }
    .footer-btn:hover {
        transform: scale(1.1);
    }
    .footer-btn img {
        width: 20px;
        height: 20px;
        margin-bottom: 4px;
    }
    .footer-btn .fas {
        font-size: 20px;
        margin-bottom: 4px;
    }
  </style>
</head>
<body>
  <div class="loading-spinner-container" id="loading-spinner-container">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div class="news-container" id="news-details">
    </div>

  <footer class="footer">
    <a href="go:a" class="footer-btn">
      <img src="https://example.com/telegram-icon.png" alt="Telegram">
      <span>تلغرام</span>
    </a>
    <a href="go:b" class="footer-btn">
      <img src="https://example.com/youtube-icon.png" alt="YouTube">
      <span>يوتيوب</span>
    </a>
    <a href="go:c" class="footer-btn">
      <img src="https://example.com/tv-icon.png" alt="TV">
      <span>تلفاز</span>
    </a>
    <a href="go:d" class="footer-btn">
      <img src="https://example.com/vod-icon.png" alt="VOD">
      <span>VOD</span>
    </a>
    <a href="javascript:void(0)" class="footer-btn">
      <i class="fas fa-search"></i>
      <span>بحث</span>
    </a>
  </footer>

  <script>
    const baseUrl = "https://www.footballgallery.net";
    const proxy = "https://api.allorigins.win/get?url=";
    const detailsContainer = document.getElementById("news-details");
    const loadingSpinnerContainer = document.getElementById("loading-spinner-container");

    const params = new URLSearchParams(window.location.search);
    const articleUrl = params.get('link');

    if (articleUrl) {
      const decodedUrl = decodeURIComponent(articleUrl);
      
      loadingSpinnerContainer.style.display = 'flex';
      detailsContainer.style.display = 'none';

      fetch(proxy + encodeURIComponent(decodedUrl))
        .then(response => {
          if (!response.ok) {
            throw new Error('فشل جلب البيانات من البروكسي');
          }
          return response.json();
        })
        .then(data => {
          loadingSpinnerContainer.style.display = 'none';
          detailsContainer.style.display = 'block';

          let parser = new DOMParser();
          let doc = parser.parseFromString(data.contents, "text/html");

          const ogImageMeta = doc.querySelector("meta[property='og:image']");
          let mainImageHtml = '';
          if (ogImageMeta) {
              const src = ogImageMeta.getAttribute('content');
              mainImageHtml = `<img src="${src}" alt="صورة الخبر الرئيسية" class="main-image">`;
          }

          const titleElement = doc.querySelector(".news-details-title h1");
          let contentElement = doc.querySelector(".article-details-contents");
          if (!contentElement) {
              contentElement = doc.querySelector(".news-text-box");
          }

          if (titleElement && contentElement) {
            const title = titleElement.textContent.trim();
            let contentHtml = contentElement.innerHTML;
            
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = contentHtml;
            const images = tempDiv.querySelectorAll('img');
            
            images.forEach(img => {
              let src = img.getAttribute('src');
              let dataSrc = img.getAttribute('data-src');
              let dataOriginal = img.getAttribute('data-original');
              let srcset = img.getAttribute('srcset');

              if (dataSrc && dataSrc.startsWith('/')) {
                img.setAttribute('src', baseUrl + dataSrc);
                img.removeAttribute('data-src');
              } else if (dataOriginal && dataOriginal.startsWith('/')) {
                img.setAttribute('src', baseUrl + dataOriginal);
                img.removeAttribute('data-original');
              } else if (src && src.startsWith('/') && !src.includes('data:')) {
                img.setAttribute('src', baseUrl + src);
              }
              
              if (srcset) {
                const updatedSrcset = srcset.split(',').map(part => {
                  const url = part.trim().split(' ')[0];
                  if (url.startsWith('/')) {
                    return baseUrl + url + part.substring(url.length);
                  }
                  return part;
                }).join(', ');
                img.setAttribute('srcset', updatedSrcset);
              }
              img.classList.remove('lazyload', 'lazy'); 
            });
            contentHtml = tempDiv.innerHTML;
            
            detailsContainer.innerHTML = `${mainImageHtml}<h1>${title}</h1>${contentHtml}`;
          } else {
            detailsContainer.innerHTML = `<div class="loading-msg">⚠️ لم يتم العثور على عنوان أو تفاصيل الخبر.</div>`;
          }
        })
        .catch(err => {
          loadingSpinnerContainer.style.display = 'none';
          detailsContainer.style.display = 'none';
          const errorMsg = document.createElement('div');
          errorMsg.className = 'loading-msg';
          errorMsg.textContent = `❌ خطأ في جلب البيانات: ${err.message}`;
          document.body.appendChild(errorMsg);
          console.error("Fetch error:", err);
        });
    } else {
      loadingSpinnerContainer.style.display = 'none';
      detailsContainer.style.display = 'none';
      const noLinkMsg = document.createElement('div');
      noLinkMsg.className = 'loading-msg';
      noLinkMsg.textContent = `⚠️ لا يوجد رابط خبر محدد لعرضه.`;
      document.body.appendChild(noLinkMsg);
    }
  </script>
</body>
</html>
